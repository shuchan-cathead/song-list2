<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🎶 歌のリスト</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Yomogi&display=swap" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: 'Nunito', sans-serif;
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      background-color: rgba(255,255,255,0.9);
      color: #333;
      min-height: 100vh;
      transition: background-image 0.5s ease, background-color 0.5s ease;
    }
    h1 {
      margin: 10px;
      font-family: 'Yomogi', cursive;
      font-size: 2em;
      color: #4a90e2;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    .content {
      padding: 10px;
      max-height: calc(100vh - 140px);
      overflow-y: auto;
    }
    input[type="text"] {
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin: 4px;
    }
    button {
      background: #a0cfff;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 6px 12px;
      margin: 4px;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover {
      background: #cce6ff;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background-color: rgba(255,255,255,0.95);
      border-radius: 10px;
      overflow: hidden;
      font-family: 'Nunito', sans-serif;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #e6f2ff;
      cursor: pointer;
    }
    .settings-toggle {
      position: fixed;
      bottom: 10px;
      right: 10px;
      z-index: 1000;
    }
    .background-toggle {
      position: fixed;
      top: 10px;
      right: 10px;
      background: #e6f2ff;
      border-radius: 8px;
      z-index: 1001;
    }
    .back-button {
      position: fixed;
      top: 10px;
      right: 120px;
      z-index: 1001;
    }
    .settings-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px;
      border-top: 2px solid #a0cfff;
      display: none;
      font-size: 14px;
      z-index: 999;
    }
    .pagination {
      text-align: center;
      margin: 10px;
    }
    .popup-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background-color: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }
    .popup-overlay iframe {
      width: 90vw;
      height: 50vh;
      border: none;
      background: #000;
    }
    @media(max-width:600px) {
      body, .settings-panel {
        font-size: 12px;
      }
      table, th, td {
        font-size: 12px;
      }
      button, input {
        font-size: 11px;
      }
    }
  </style>
</head>
<body>
  <h1 id="pageTitle">🎶 歌のリスト</h1>
  <div class="background-toggle"><button onclick="toggleBackgroundOnly()">🖼 背景表示切替</button></div>
  <div class="back-button" style="display:none"><button onclick="toggleBackgroundOnly()">🔙 戻る</button></div>
  <div class="content" id="mainContent">
    <!-- 曲リスト入力・表示部 -->
    <input type="text" id="newTitle" placeholder="曲名">
    <input type="text" id="newArtist" placeholder="アーティスト名">
    <input type="text" id="newURL" placeholder="動画URL（任意）">
    <button onclick="addSong()">追加</button>
    <table id="songTable">
      <thead><tr><th>#</th><th onclick="sortBy('title')">曲名</th><th onclick="sortBy('artist')">アーティスト</th><th>操作</th></tr></thead>
      <tbody></tbody>
    </table>
    <div class="pagination">
      <button onclick="prevPage()">⏮ 前へ</button>
      <span id="pageInfo"></span>
      <button onclick="nextPage()">次へ ⏭</button>
    </div>
  </div>
  <div class="settings-toggle"><button onclick="toggleSettings()">⚙️ 設定</button></div>
  <div class="settings-panel" id="settingsPanel">
    <div><label>ページタイトル：</label><input type="text" id="pageTitleInput" oninput="updateTitle()"></div>
    <div><label>背景画像URL：</label><input type="text" id="bgUrlInput" oninput="updateBackground()"> またはアップロード：<input type="file" id="bgUpload" accept="image/*" onchange="uploadBackground()"><button onclick="resetBackground()">リセット</button></div>
    <div><label>文字色：</label><input type="color" id="textColor" value="#000000" onchange="updateTextColor()"></div>
    <div><label>曲リストのエクスポート：</label><button onclick="exportSongs()">📤 書き出す</button></div>
    <div><label>曲リストのインポート：</label><input type="file" id="importFile" accept=".json"><button onclick="importSongs()">📥 読み込む</button></div>
  </div>
  <div class="popup-overlay" id="popup">
    <iframe id="videoFrame" allowfullscreen></iframe>
  </div>
<script>
let songs = JSON.parse(localStorage.getItem("songList") || "[]");
let currentPage = 1, pageSize = 20, sortKey = '', sortAsc = true, showingBackgroundOnly = false;
function renderTable(){
  const tbody = document.querySelector("#songTable tbody");
  tbody.innerHTML = "";
  let arr = [...songs];
  if(sortKey) arr.sort((a,b)=>(sortAsc?1:-1)*(a[sortKey]||'').localeCompare(b[sortKey]||''));
  const start = (currentPage - 1) * pageSize;
  const pageArr = arr.slice(start, start + pageSize);
  pageArr.forEach((s,i)=>{
    const tr = document.createElement("tr");
    const urlButton = s.url ? `<button onclick="showVideo('${s.url}')">🎬 再生</button>` : '';
    tr.innerHTML = `<td>${start+i+1}</td><td>${s.title}</td><td>${s.artist}</td><td><button onclick="editSong(${songs.indexOf(s)})">編集</button><button onclick="deleteSong(${songs.indexOf(s)})">削除</button> ${urlButton}</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("pageInfo").textContent = `ページ ${currentPage} / ${Math.max(1, Math.ceil(songs.length / pageSize))}`;
}
function addSong(){
  const title = document.getElementById("newTitle").value.trim();
  const artist = document.getElementById("newArtist").value.trim();
  const url = document.getElementById("newURL").value.trim();
  if(!title || !artist) return alert("曲名とアーティスト名を入力してください。");
  songs.push({ title, artist, url });
  saveSongs();
  document.getElementById("newTitle").value = "";
  document.getElementById("newArtist").value = "";
  document.getElementById("newURL").value = "";
  renderTable();
}
function editSong(i){
  const s = songs[i];
  const title = prompt("曲名", s.title);
  const artist = prompt("アーティスト", s.artist);
  const url = prompt("動画URL", s.url || '');
  if(title && artist){ songs[i] = { title, artist, url }; saveSongs(); renderTable(); }
}
function deleteSong(i){ if(confirm("削除しますか？")){ songs.splice(i,1); saveSongs(); renderTable(); } }
function sortBy(key){ sortKey = key; sortAsc = !sortAsc; renderTable(); }
function nextPage(){ if(currentPage < Math.ceil(songs.length / pageSize)){ currentPage++; renderTable(); window.scrollTo(0,0); } }
function prevPage(){ if(currentPage > 1){ currentPage--; renderTable(); window.scrollTo(0,0); } }
function saveSongs(){ localStorage.setItem("songList", JSON.stringify(songs)); }
function exportSongs(){ const blob = new Blob([JSON.stringify(songs)], {type:"application/json"}); const url = URL.createObjectURL(blob); const a = document.createElement("a"); a.href = url; a.download = "songs.json"; a.click(); }
function importSongs(){ const file = document.getElementById("importFile").files[0]; if(!file) return; const reader = new FileReader(); reader.onload = e => { try { songs = JSON.parse(e.target.result); saveSongs(); renderTable(); } catch(err) { alert("読み込みエラー"); } }; reader.readAsText(file); }
function updateTitle(){ document.getElementById("pageTitle").textContent = document.getElementById("pageTitleInput").value || "🎶 歌のリスト"; }
function updateBackground(){ const url = document.getElementById("bgUrlInput").value; document.body.style.backgroundImage = url ? `url('${url}')` : 'none'; localStorage.setItem("bgImageUrl", url); }
function uploadBackground(){ const file = document.getElementById("bgUpload").files[0]; if(!file) return; const reader = new FileReader(); reader.onload = e => { document.body.style.backgroundImage = `url('${e.target.result}')`; localStorage.setItem("bgImage", e.target.result); }; reader.readAsDataURL(file); }
function resetBackground(){ document.body.style.backgroundImage = 'none'; document.getElementById("bgUrlInput").value = ''; localStorage.removeItem("bgImage"); localStorage.removeItem("bgImageUrl"); }
function updateTextColor(){ document.body.style.color = document.getElementById("textColor").value; localStorage.setItem("textColor", document.getElementById("textColor").value); }
function toggleSettings(){ const panel = document.getElementById("settingsPanel"); panel.style.display = panel.style.display === "block" ? "none" : "block"; }
function toggleBackgroundOnly(){ showingBackgroundOnly = !showingBackgroundOnly; document.getElementById("mainContent").style.display = showingBackgroundOnly ? "none" : "block"; document.querySelector(".settings-panel").style.display = "none";
  document.querySelector(".back-button").style.display = showingBackgroundOnly ? "block" : "none"; }
function showVideo(url){ const popup = document.getElementById("popup"); const frame = document.getElementById("videoFrame"); frame.src = url.includes("youtube") ? url.replace("watch?v=","embed/") : url; popup.style.display = "flex"; }
document.getElementById("popup").onclick = function(){ this.style.display = "none"; document.getElementById("videoFrame").src = ""; }
window.onload = function(){
  const savedTitle = localStorage.getItem("pageTitle");
  if(savedTitle) document.getElementById("pageTitle").textContent = savedTitle;
  const savedColor = localStorage.getItem("textColor");
  if(savedColor) document.body.style.color = savedColor;
  const savedBg = localStorage.getItem("bgImage") || localStorage.getItem("bgImageUrl");
  if(savedBg) document.body.style.backgroundImage = `url('${savedBg}')`;
  renderTable();
};
</script>
</body>
</html>
