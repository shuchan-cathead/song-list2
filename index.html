<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>üé∂ Ê≠å„ÅÆ„É™„Çπ„Éà</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      transition: background-image 0.3s ease, background-color 0.3s ease;
      color: #000;
      min-height: 100vh;
    }
    h1 { margin-bottom: 10px; }
    button { padding: 5px 10px; margin: 2px; font-size: 14px; }
    input[type="text"] { margin: 3px; padding: 5px; font-size: 14px; }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: rgba(255, 255, 255, 0.95);
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f0f0f0;
      cursor: pointer;
    }

    .pagination {
      margin-top: 10px;
      text-align: center;
    }

    /* „É¢„Éº„ÉÄ„É´„Çπ„Çø„Ç§„É´ */
    .modal {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #000;
      padding: 10px;
      border-radius: 8px;
      max-width: 90%;
      max-height: 80%;
    }
    .modal-content iframe {
      width: 560px;
      height: 315px;
      max-width: 100%;
      max-height: 100%;
      border: none;
    }
    .modal-close {
      color: white;
      font-size: 20px;
      float: right;
      cursor: pointer;
    }
    @media(max-width:600px){
      body, table, th, td, input, button { font-size: 12px; }
    }
  </style>
</head>
<body>

<h1>üé∂ Ê≠å„ÅÆ„É™„Çπ„Éà</h1>

<div>
  <input type="text" id="newTitle" placeholder="Êõ≤Âêç">
  <input type="text" id="newArtist" placeholder="„Ç¢„Éº„ÉÜ„Ç£„Çπ„ÉàÂêç">
  <input type="text" id="newUrl" placeholder="ÂãïÁîªURL (ÁúÅÁï•ÂèØ)">
  <button onclick="addSong()">ËøΩÂä†</button>
</div>

<table id="songTable">
  <thead>
    <tr>
      <th>#</th>
      <th onclick="sortBy('title')">Êõ≤Âêç ‚ñ≤‚ñº</th>
      <th onclick="sortBy('artist')">„Ç¢„Éº„ÉÜ„Ç£„Çπ„Éà ‚ñ≤‚ñº</th>
      <th>ÂãïÁîª</th>
      <th>Êìç‰Ωú</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div class="pagination">
  <button onclick="prevPage()">‚èÆ Ââç„Å∏</button>
  <span id="pageInfo"></span>
  <button onclick="nextPage()">Ê¨°„Å∏ ‚è≠</button>
</div>

<!-- „É¢„Éº„ÉÄ„É´ÂãïÁîªÂÜçÁîü -->
<div class="modal" id="videoModal">
  <div class="modal-content">
    <span class="modal-close" onclick="closeModal()">‚úñ</span>
    <iframe id="videoFrame" src="" allowfullscreen></iframe>
  </div>
</div>

<script>
  const pageSize = 20;
  let songs = JSON.parse(localStorage.getItem("songList") || "[]");
  let currentPage = 1;
  let sortKey = null;
  let sortAsc = true;

  function renderTable() {
    let arr = [...songs];
    if (sortKey) {
      arr.sort((a, b) =>
        sortAsc
          ? (a[sortKey] || '').localeCompare(b[sortKey] || '')
          : (b[sortKey] || '').localeCompare(a[sortKey] || '')
      );
    }

    const tbody = document.querySelector("#songTable tbody");
    tbody.innerHTML = "";
    const start = (currentPage - 1) * pageSize;
    const pageArr = arr.slice(start, start + pageSize);

    pageArr.forEach((song, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${start + i + 1}</td>
        <td>${song.title}</td>
        <td>${song.artist}</td>
        <td>${song.url ? `<button onclick="openVideo('${song.url}')">ÂÜçÁîü</button>` : ""}</td>
        <td>
          <button onclick="editSong(${songs.indexOf(song)})">Á∑®ÈõÜ</button>
          <button onclick="deleteSong(${songs.indexOf(song)})">ÂâäÈô§</button>
        </td>`;
      tbody.appendChild(tr);
    });

    document.getElementById("pageInfo").textContent = `„Éö„Éº„Ç∏ ${currentPage} / ${Math.max(Math.ceil(songs.length / pageSize), 1)}`;
  }

  function addSong() {
    const title = document.getElementById("newTitle").value.trim();
    const artist = document.getElementById("newArtist").value.trim();
    const url = document.getElementById("newUrl").value.trim();
    if (!title || !artist) return alert("Êõ≤Âêç„Å®„Ç¢„Éº„ÉÜ„Ç£„Çπ„ÉàÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ");

    songs.push({ title, artist, url });
    saveSongs();
    document.getElementById("newTitle").value = "";
    document.getElementById("newArtist").value = "";
    document.getElementById("newUrl").value = "";
    renderTable();
  }

  function editSong(index) {
    const s = songs[index];
    const title = prompt("Êñ∞„Åó„ÅÑÊõ≤Âêç", s.title);
    const artist = prompt("Êñ∞„Åó„ÅÑ„Ç¢„Éº„ÉÜ„Ç£„Çπ„ÉàÂêç", s.artist);
    const url = prompt("Êñ∞„Åó„ÅÑÂãïÁîªURLÔºàÁ©∫Ê¨ÑÂèØÔºâ", s.url || "");

    if (title && artist) {
      songs[index] = { title: title.trim(), artist: artist.trim(), url: url.trim() };
      saveSongs();
      renderTable();
    }
  }

  function deleteSong(index) {
    if (confirm("Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü")) {
      songs.splice(index, 1);
      saveSongs();
      if (currentPage > Math.ceil(songs.length / pageSize)) currentPage--;
      renderTable();
    }
  }

  function sortBy(key) {
    if (sortKey === key) {
      sortAsc = !sortAsc;
    } else {
      sortKey = key;
      sortAsc = true;
    }
    renderTable();
  }

  function nextPage() {
    if (currentPage < Math.ceil(songs.length / pageSize)) {
      currentPage++;
      renderTable();
    }
  }

  function prevPage() {
    if (currentPage > 1) {
      currentPage--;
      renderTable();
    }
  }

  function saveSongs() {
    localStorage.setItem("songList", JSON.stringify(songs));
  }

  function loadSongs() {
    songs = JSON.parse(localStorage.getItem("songList") || "[]");
    if (currentPage > Math.ceil(songs.length / pageSize)) currentPage = 1;
    renderTable();
  }

  function openVideo(url) {
    const embedUrl = getEmbedUrl(url);
    if (!embedUrl) return alert("Âüã„ÇÅËæº„Åø„Åß„Åç„Å™„ÅÑURLÂΩ¢Âºè„Åß„Åô");
    document.getElementById("videoFrame").src = embedUrl;
    document.getElementById("videoModal").style.display = "flex";
  }

  function closeModal() {
    document.getElementById("videoModal").style.display = "none";
    document.getElementById("videoFrame").src = "";
  }

  function getEmbedUrl(url) {
    try {
      if (url.includes("youtube.com/watch?v=")) {
        const videoId = new URL(url).searchParams.get("v");
        return `https://www.youtube.com/embed/${videoId}`;
      }
      if (url.includes("youtu.be/")) {
        const videoId = url.split("youtu.be/")[1];
        return `https://www.youtube.com/embed/${videoId}`;
      }
      if (url.includes("vimeo.com")) {
        const videoId = url.split("vimeo.com/")[1];
        return `https://player.vimeo.com/video/${videoId}`;
      }
      return null; // „Çµ„Éù„Éº„ÉàÂ§ñURL
    } catch (e) {
      return null;
    }
  }

  window.onload = function () {
    loadSongs();
  }
</script>

</body>
</html>
